# JPA에서 가장 중요한 2가지

- 객체와 관계형 데이터베이스 매핑 (ORM)
- 영속성 컨텍스트

## Entity manager factory, entity manager

## 영속성 컨텍스트

- JPA를 이해하는데 가장 중요한 용어
- 엔티티를 영구 저장하는 환경이라는 뜻
- EntityManager.persist(entity);

## 영속 상태 vs 비영속 상태

- 영속상태 : 1차캐시
- 비영속 : 아무것도 아닌 상태

## 엔티티 수정

- 변경 감지 (Dirty check)
- 자동으로 update query 발생(영속성 컨텍스트)

# 플러시

- 영속성 컨텍스트의 변경내용을 데이터베이스에 반영

## 플러시 발생

- 변경 감지
- 수정된 엔티티 쓰기 지연 SQL 저장소에 등록
- 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스에 전송

## 영속성 컨텍스트를 프러시하는 방법

- em.flush
- 트랜잭션 커밋
- JPQL 쿼리 실행 - 플러시 자동호출

## 플러시는!!

- **영속성 컨텍스트를 비우지 않음**
- 영속성 컨텍스트의 변경내용을 데이터베이스에 동기화
- 트랜잭션이라는 작업 단위가 중요 → 커밋 직전에만 동기화하면 됨

# 준영속 상태

- 영속 → 준영속
- 영속 상태의 엔티티가 영속성 컨텍스트에서 분리(detached)
- 영속성 컨텍스트가 제공하는 기능을 사용 못함

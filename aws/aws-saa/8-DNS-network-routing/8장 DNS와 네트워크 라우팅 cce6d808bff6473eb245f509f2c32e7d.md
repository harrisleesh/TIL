# 8장 DNS와 네트워크 라우팅

# 소개

- DNS(Domain Name System)은 사람이 읽을 수 있는 이름을 사용해 네트워크상에서 리소스를 사용할 수 있게 하는 역할을 한다.
- Amazon Route 53은 DNS + others
- CloudFront는 Amazon의 글로벌 콘텐츠 전송 네트워크(CDN, Content Delivery Network)

# Domain Name System

DNS는 사람이 읽을 수 있는 도메인 이름(예, example.com)을 기계가 읽을 수 있는 ip주소(예, 93.184.216.34)로 연결한다.

## 네임 스페이스

인터넷 이름 시스템은 도메인 이름 계층 구조의 네임 스페이스 내에서 관리되며, 사람이 읽을 수 있는 이름과 연결될 수 있도록 한다. 이를 계층 구조라고 하며, 인터넷을 여러 개 작은 네임 스페이스로 나눌 수 있다.

![8%E1%84%8C%E1%85%A1%E1%86%BC%20DNS%E1%84%8B%E1%85%AA%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20cce6d808bff6473eb245f509f2c32e7d/Untitled.png](8%E1%84%8C%E1%85%A1%E1%86%BC%20DNS%E1%84%8B%E1%85%AA%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20cce6d808bff6473eb245f509f2c32e7d/Untitled.png)

## 이름 서버

### DNS 서비스를 제공하는 서버

- 모든 컴퓨터는 내부에 간단한 이름 서버 데이터베이스를 갖고 있으며, 이 데이터베이스에는 localhost와 같은 hostnames와 IP 주소가 연결된 항목이 포함돼 있다.
    - 127.0.0.1  localhost
- 로컬 이름 서버에 쿼리한 항목이 없는 경우, 컴퓨터의 네트워크 인터페이스 구성에서 지정한 외부 DNS 이름 서버 중 하나로 쿼리가 전달된다. (인터페이스를 지정할 수 있음)

## 인터넷 주소 관점에서 도메인과 도메인 이름

### 도메인

- 하나 이상의 서버
- 데이터 저장소나 단일 도메인 이름으로 식별되는 디지털 리소스

### 도메인 이름

- 네트워크 요청을 이 도메인 리소스로 연결하기 위해 등록한 이름

## 도메인 등록

최상위 이름 서버가 새 도메인 이름 쿼리에 응답하려면, 그 전에 **이름 서버에 해당 도메인 이름이 등록돼 있어야 한다.** 

도메인 이름 등록 대행자는 이름 서버 간에 도메인 이름 데이터를 전파하며, VeriSign과 같은 등록 운영자와 협업해서 등록된 도메인이 전 세계에서 통용될 수 있도록 한다. 

**Amazon Route 53은 도메인 이름 등록 대행자의 역할을 한다.**

## FQDN(Fully Qualified Domain Name)

- 전체 주소 도메인 네임
- 호스트 이름과 도메인 이름을 포함한 전체 도메인 이름
- www.yahoo.com.

## 영역과 영역 파일

영역(zone, Route 53의 호스팅 영역) - DNS 도메인의 하위 집합

영역 파일 - 영역 내 리소스와 도메인의 DNS주소를 연결하는 방식을 기술한 텍스트 파일

[영역 파일의 리소스 레코드에 포함된 데이터 범주](https://www.notion.so/cfbed794fd154d8a9bd92ca119fc5833)

[example.com](http://example.com). 1h IN NS ns-750.awsdns-30.net.

## 레코드 유형

영역 파일의 리소스 레코드에 입력된 레코드 유형에 따라 레코드의 데이터 형식과 사용 방법이 결정된다.

[일반적 DNS 레코드 유형](https://www.notion.so/b8e3335a5dc74c59a50df1d89207a412)

## 별칭 레코드

 한 도메인의 트래픽을 다른 도메인으로 라우팅

# Amazon Route 53

### Amazon Route 53은 단순한 DNS 이상의 서비스를 제공

- 도메인 등록
- DNS 관리
- 가용성 모니터링(상태 검사)
- 라우팅 정책(트래픽 관리)

(Route 53에서 숫자 53이 붙은 이유는 DNS 트래픽이 네트워크 포트 53번을 사용하기 때문이다.)

## 도메인 등록

1. 도메인 등록 : ICANN이 인증한 도메인 이름 등록 대행자(예, GoDaddy 등)에 도메인을 등록하듯, Route 53을 사용해서 쉽게 도메인 등록을 할 수 있으며, AWS 인프라와 연결할 도메인 이름 등록에 Route 53을 사용하면 운영 업무를 간소화할 수 있다.
2. 도메인 이전 : 등록 대행자의 관리 인터페이스에서 도메인을 이전할 수 있게 한 다음, 인증 코드를 요청해서 기존 도메인을 현재 등록 대행자로부터 등록 이전할 수 있고, 이전 준비가 완료되면 Route 53에 그 코드를 제공한다.
3. 도메인 관리 : 도메인을 현재 등록 대행자에게 그대로 두는 경우에도 Route 53으로 DNS 구성을 관리할 수 있으며, 이 때는 간단하게 Route 53 레코드 집합에 있는 이름 서버 주소를 복사해서 등록 대행자의 관리 기능에 붙여넣기만 하면 된다.

## DNS 관리

### 도메인을 리소스와 연결

- Route 53에서는 사용자가 브라우저, 전자 메일 클라이언트, 프로그래밍 방식으로 도메인 이름을 호출할 때 전달할 것을 설정하는 호스팅 영역을 생성하고 구성할 수 있다.
- Route 53에서 미리 구성된 영역 파일을 가져오는 대신 콘솔이나 AWS CLI로 호스트 영역을 직접 구성할 수 있다.
- Route 53의 새 호스팅 영역 생성에서 도메인 이름을 입력하고, 퍼블릭으로 호스팅할지, 프라이빗으로 호스팅할지 선택할 수 있다.
- Route 53은 자동으로 SOA 레코드를 생성하고 4개의 이름 서버 주소를 제공한다. 도메인과 생성하고자 하는 하위 도메인의 관계를 정의하는 레코드 세트를 새로 생성해서 리소스가 도메인 이름에 액세스하게 한다.

## 가용성 모니터링

1. 레코드 세트를 생성할 때 라우팅 정책을 선택한다. 
2. 단순 라우팅 정책 이외에 다른 라우팅 정책을 선택하면, 정책을 상태 검사와 연결할 수 있다. 
3. 각각 생성, 구성하고 이름을 입력한 레코드 세트에서 상태 검사를 설정하면, 상태 검사는 연결된 리소스를 정기적으로 검사한다.
4. 무응답 횟수가 설정값을 넘으면 Route 53은 리소스가 오프라인인 것으로 간주하고 트래픽을 백업 리소스로 전환한다.

## 라우팅 정책

- **단순 라우팅 정책** – 도메인에 대해 특정 기능을 수행하는 하나의 리소스만 있는 경우(예: example.com 웹 사이트의 콘텐츠를 제공하는 하나의 웹 서버)에 사용합니다.
- **장애 조치 라우팅 정책** – 액티브-패시브 장애 조치를 구성하려는 경우에 사용합니다.
- **지리 위치 라우팅 정책** – 사용자의 위치에 기반하여 트래픽 라우팅하려는 경우에 사용합니다.
- **지리 근접 라우팅 정책** – 리소스의 위치를 기반으로 트래픽을 라우팅하고 필요에 따라 한 위치의 리소스에서 다른 위치의 리소스로 트래픽을 보내려는 경우에 사용합니다.
- **지연 시간 라우팅 정책** – 여러 AWS 리전에 리소스가 있고 최상의 지연 시간을 제공하는 리전으로 트래픽을 라우팅하려는 경우에 사용합니다.
- **다중 응답 라우팅 정책** – Route 53이 DNS 쿼리에 무작위로 선택된 최대 8개의 정상 레코드로 응답하게 하려는 경우에 사용합니다.
- **가중치 기반 라우팅 정책** – 사용자가 지정하는 비율에 따라 여러 리소스로 트래픽을 라우팅하려는 경우에 사용합니다.

## Route 53 트래픽 흐름

- 콘솔 기반 그래픽 인터페이스로 구축해 놓은 복잡한 라우팅 정책 조합을 시각화한다.
- AWS 계정과 연결된 모든 리소스 엔드포인트와 라우팅 정책이 매끄럽게 통합돼 있으므로 트래픽 흐름은 정교한 라우팅 구조를 간단하면서도 신속하게 구축할 수 있으며, 이를 위해 라우팅 템플릿을 생성하거나 변경할 수 있다.
- 트래픽 흐름에서는 일반 Route 53 정책으로는 불가능한 지리 근접 라우팅 같은 정책을 구현할 수 있다. (지리 근접 라우팅은 지리 위치 라우팅을 더욱 정밀한 수준으로 구현)

![8%E1%84%8C%E1%85%A1%E1%86%BC%20DNS%E1%84%8B%E1%85%AA%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20cce6d808bff6473eb245f509f2c32e7d/Untitled%201.png](8%E1%84%8C%E1%85%A1%E1%86%BC%20DNS%E1%84%8B%E1%85%AA%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20cce6d808bff6473eb245f509f2c32e7d/Untitled%201.png)

# Amazon CloudFront

### CDN (Contents Delivery Network)이란?

- 지리적, 물리적으로 떨어져 있는 사용자에게 컨텐츠를 더 빠르게 제공할 수 있는 기술
- 느린 응답속도, 다운로딩 타임을 극복하기 위한 기술

### Amazon CloudFront

- 콘텐츠를 전송하는 방식을 구성할 때, 어떻게 엣지 로케이션 네트워크를 통해 콘텐츠를 배포할 것인가, 어떻게 사용자에게 전달할 것인가를 정의한다.
- 요청이 오면, 요청을 보낸 사용자 위치를 확인하고 지연 시간이 가장 짧게 콘텐츠를 전송할 수 있는 엔드포인트가 어디인지 계산한다. 해당 엔드포인트에 콘텐츠가 처음 요청되면, 원본 서버에서 해당 콘텐츠를 복사해 온다. 그 다음 요청부터는 엔드포인트에 캐싱된 사본을 전달해서 전송이 더욱 빨라진다.
- 배포의 종류 어떤 미디어를 전달하려는가에 따라 다르며, 웹페이지나 그래픽 콘텐츠는 웹 배포를 선택하면 되고, 비디오 콘텐츠는 CloudFront RTMP 배포가 적합하다.
- 배포 구성시 ACM(AWS Certificate Manager) SSL/TLS 암호화 인증서를 무료로 배포에 추가할 수 있다. 이는 네트워크 스니퍼나 중간자 공격을 막을 수 있다.

![8%E1%84%8C%E1%85%A1%E1%86%BC%20DNS%E1%84%8B%E1%85%AA%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20cce6d808bff6473eb245f509f2c32e7d/Untitled%202.png](8%E1%84%8C%E1%85%A1%E1%86%BC%20DNS%E1%84%8B%E1%85%AA%20%E1%84%82%E1%85%A6%E1%84%90%E1%85%B3%E1%84%8B%E1%85%AF%E1%84%8F%E1%85%B3%20%E1%84%85%E1%85%A1%E1%84%8B%E1%85%AE%E1%84%90%E1%85%B5%E1%86%BC%20cce6d808bff6473eb245f509f2c32e7d/Untitled%202.png)

# 요약

- DNS 시스템은 인터넷 프로토콜(IP 주소)과 도메인 이름 계층, 두 가지 최상위 네임스페이스로 인터넷 리소스 주소를 관리한다. ICANN(Internet Corporation for Assigned Names and Numbers)은 VeriSign과 같은 등록 운영자를 통해 이름 서버 및 Route 53과 같은 도메인 이름 등록 대행자를 관리한다.
- FQDN(fully Qualified Domain Name)은 org 또는 com과 같은 TLD와 amazon과 같은 SLD로 구성된다. FQDN에는 종종 '루트'를 나타내는 점이 맨 뒤에 붙는다.
- DNS 세부 구성은 호스팅 영역으로 이루어지며 리소스 레코드 세트를 만들어 인바운드 도메인 트래픽의 방향을 제어한다. A, CNAME, MX와 같은 여러 레코드 유형 중 하나를 정해서 동작을 정의한다.
- 새로 Route 53 호스트 영역을 생성하면 그 안에는 SOA(Start Of Authority) 레코드 세트와 요청이 전달되는 이름 서버 목록이 포함돼 있다. 레코드 세트를 하나 이상 생성해서 Route 53이 요청을 처리할 도메인 이름을 설정한다.
- Route 53이 상태 검사로 리소스의 실행 상태를 정기적으로 모니터링하도록 구성할 수 있다. 문제 발생을 경고하는 것뿐만 아니라, 상태 검사를 Route 53 라우팅 정책과 통합해 애플리케이션의 가용성을 향상할 수 있다.
- 가중치 기반 라우팅 정책을 사용하면 처리 능력에 따라 여러 병렬 리소스로 트래픽을 비율대로 전송하도록 지정할 수 있다.
- 지연 시간 라우팅 정책은 여러 리소스 중에서 지연 시간이 가장 짧은 곳에 트래픽을 전달해서 가장 빠른 서비스를 제공한다.
- 장애 조치 라우팅은 리소스를 모니터링하고 장애가 발생하면 후속 트래픽을 백업 리소스로 라우팅한다.
- 지리 위치 라우팅은 요청한 곳의 위치를 확인하고 적절한 리소스에서 응답을 보내도록 한다.
- Amazon CloudFront는 CDN 서비스로서 웹사이트와 디지털 미디어의 지연 시간을 줄이기 위해 엣지에서 콘텐츠를 캐싱한다.